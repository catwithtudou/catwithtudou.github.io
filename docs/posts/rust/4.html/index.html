<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰ - </title><meta name="Description" content="ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸&#39;s blog"><meta property="og:title" content="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰" />
<meta property="og:description" content="æ­¤æ–‡æ¡£å†…å®¹ä¸ºé£ä¹¦æ–‡æ¡£å¤åˆ¶è¿‡æ¥ä½œä¸ºæœç´¢ï¼Œå­˜åœ¨å†…å®¹æ ¼å¼ä¸å…¼å®¹æƒ…å†µï¼Œå»ºè®®çœ‹åŸé£ä¹¦æ–‡æ¡£ èƒŒæ™¯ é€šè¿‡ä¸Šæ–‡ï¼ˆBuild A Parser By Rustï¼ˆä¸Šï¼‰ ï¼‰æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhengyua.cn/posts/rust/4.html/" /><meta property="og:image" content="https://zhengyua.cn/images/mood.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-26T21:00:00+08:00" />
<meta property="article:modified_time" content="2024-01-26T21:00:00+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://zhengyua.cn/images/mood.jpeg"/>

<meta name="twitter:title" content="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰"/>
<meta name="twitter:description" content="æ­¤æ–‡æ¡£å†…å®¹ä¸ºé£ä¹¦æ–‡æ¡£å¤åˆ¶è¿‡æ¥ä½œä¸ºæœç´¢ï¼Œå­˜åœ¨å†…å®¹æ ¼å¼ä¸å…¼å®¹æƒ…å†µï¼Œå»ºè®®çœ‹åŸé£ä¹¦æ–‡æ¡£ èƒŒæ™¯ é€šè¿‡ä¸Šæ–‡ï¼ˆBuild A Parser By Rustï¼ˆä¸Šï¼‰ ï¼‰æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£"/>
<meta name="twitter:site" content="@catwithtudou"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://zhengyua.cn/posts/rust/4.html/" /><link rel="prev" href="https://zhengyua.cn/posts/project/common/0.html/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/zhengyua.cn\/posts\/rust\/4.html\/"
        },"genre": "posts","keywords": "rust, parser","wordcount":  6311 ,
        "url": "https:\/\/zhengyua.cn\/posts\/rust\/4.html\/","datePublished": "2024-01-26T21:00:00+08:00","dateModified": "2024-01-26T21:00:00+08:00","publisher": {
            "@type": "Organization",
            "name": "ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸"},"author": {
                "@type": "Person",
                "name": "ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <a href="https://github.com/catwithtudou" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
        <div class="header-title">
            <a href="/" title=""><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/about/"> å…³äº </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="è¯·è¾“å…¥ä½ æƒ³è¦æœç´¢çš„å†…å®¹" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <a href="https://github.com/catwithtudou" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
            <div class="header-title">
                <a href="/" title=""><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <a href="https://github.com/catwithtudou" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="è¯·è¾“å…¥ä½ æƒ³è¦æœç´¢çš„å†…å®¹" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/about/" title="">å…³äº</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/catwithtudou" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/rust/"><i class="far fa-folder fa-fw"></i>rust</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-01-26">2024-01-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 6311 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 13 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#èƒŒæ™¯">èƒŒæ™¯</a></li>
    <li><a href="#json-æ ‡å‡†">Json æ ‡å‡†</a></li>
    <li><a href="#åŸºäº-nom-å®ç°">åŸºäº nom å®ç°</a>
      <ul>
        <li><a href="#json-model">Json Model</a></li>
        <li><a href="#å…·ä½“ç±»å‹è§£æ">å…·ä½“ç±»å‹è§£æ</a></li>
        <li><a href="#é¡¶å±‚è§£æå‡½æ•°">é¡¶å±‚è§£æå‡½æ•°</a></li>
      </ul>
    </li>
    <li><a href="#åŸºäº-pest-å®ç°">åŸºäº pest å®ç°</a>
      <ul>
        <li><a href="#json-model-1">Json Model</a></li>
        <li><a href="#pest--grammar-è§£æ">Pest  Grammar è§£æ</a></li>
        <li><a href="#ast-ç”Ÿæˆå’Œè§£æ">AST ç”Ÿæˆå’Œè§£æ</a></li>
      </ul>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>æ­¤æ–‡æ¡£å†…å®¹ä¸ºé£ä¹¦æ–‡æ¡£å¤åˆ¶è¿‡æ¥ä½œä¸ºæœç´¢ï¼Œå­˜åœ¨å†…å®¹æ ¼å¼ä¸å…¼å®¹æƒ…å†µï¼Œå»ºè®®çœ‹åŸ<a href="https://jih9axn4gg.feishu.cn/wiki/VmmVwdAMHiLCOJkNMXwcJGq6nfg?from=from_copylink" target="_blank" rel="noopener noreffer">é£ä¹¦æ–‡æ¡£</a></p>
</blockquote>
<h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>é€šè¿‡ä¸Šæ–‡ï¼ˆ<a href="https://jih9axn4gg.feishu.cn/wiki/WdxwwjNnbivzzXkZZwZcR5l7nPd?chunked=false" target="_blank" rel="noopener noreffer">Build A Parser By Rustï¼ˆä¸Šï¼‰</a> ï¼‰æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†è§£æå™¨çš„ç›¸å…³æ¦‚å¿µåŠå…¶ Rust ä¸­è§£æå™¨åº“çš„ç›¸å…³ä½¿ç”¨ç­‰ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ä¸Šæ–‡å­¦åˆ°çš„ä¸œè¥¿å®è·µåˆ°å…·ä½“çš„ case ä¸­ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å…¶æ¦‚å¿µå’ŒæŒæ¡å…¶å®é™…çš„åº”ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½äº†è§£åˆ°éƒ¨åˆ†è§£æå™¨å®ç°çš„ç›¸å…³è®¾è®¡ï¼Œä¸ºåç»­å®ç°è‡ªå®šä¹‰çš„è§£æå™¨æä¾›æ€è·¯ã€‚</p>
<p>ä¸‹é¢å°†ä¼šå¸¦é¢†å¤§å®¶ï¼Œåˆ†åˆ«é€šè¿‡ nom å’Œ pest æ¥ç®€å•å®ç°è¾ƒä¸ºå¸¸è§ä¸”åè®®è¾ƒä¸ºç®€å•çš„ Json è§£æå™¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä¸‹é¢ä½¿ç”¨åˆ°çš„ nom æˆ–è€… pest çš„ä¾èµ–ç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆæœ¬</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TOML" data-lang="TOML"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">pest</span> <span class="p">=</span> <span class="s2">&#34;2.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">pest_derive</span> <span class="p">=</span> <span class="s2">&#34;2.6&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">nom</span> <span class="p">=</span> <span class="s2">&#34;7.1.3&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¸‹é¢åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œåªä¼šè§£é‡Šéƒ¨åˆ†é‡è¦æˆ–ä¸Šæ–‡æ²¡æœ‰æåˆ°çš„ API çš„å…·ä½“å«ä¹‰ï¼Œè‹¥æƒ³äº†è§£å¯æŸ¥é˜…<a href="https://jih9axn4gg.feishu.cn/wiki/WdxwwjNnbivzzXkZZwZcR5l7nPd?from=from_copylink" target="_blank" rel="noopener noreffer">ä¸Šæ–‡</a>æˆ–åº“æ–‡æ¡£</li>
<li>æ­¤ç¯‡æ–‡æ¡£æ„é€ çš„è§£æå™¨åªéªŒè¯äº†è§£æçš„æ­£ç¡®æ€§ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œç›¸å…³çš„æ€§èƒ½å‹æµ‹ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯è‡ªè¡Œå°è¯•</li>
<li>å…·ä½“æºç å¯æŸ¥çœ‹ï¼š<a href="https://github.com/catwithtudou/parser_toy/tree/main" target="_blank" rel="noopener noreffer">https://github.com/catwithtudou/parser_toy/tree/main</a></li>
</ul>
</blockquote>
<h1 id="json-æ ‡å‡†">Json æ ‡å‡†</h1>
<blockquote>
<p>Jsonï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚å®ƒé‡‡ç”¨æ˜“äºé˜…è¯»çš„æ–‡æœ¬å½¢å¼è¡¨ç¤ºæ•°æ®ï¼Œå¯¹äººç±»æ¥è¯´æ˜“äºé˜…è¯»å’Œç¼–å†™ã€‚Json æ ¼å¼ç”±é”®å€¼å¯¹ç»„æˆï¼Œä½¿ç”¨äº†ç±»ä¼¼äº JavaScript å¯¹è±¡çš„è¯­æ³•ï¼Œå› æ­¤å¾—å JavaScript Object Notationã€‚Json æ ¼å¼é€šå¸¸ç”¨äºåœ¨ç½‘ç»œä¼ è¾“æ•°æ®ã€å­˜å‚¨é…ç½®ä¿¡æ¯ã€ä»¥åŠåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´äº¤æ¢æ•°æ®ã€‚å®ƒåœ¨ Web å¼€å‘ä¸­éå¸¸å¸¸è§ï¼Œä¾‹å¦‚ç”¨äº API çš„æ•°æ®ä¼ è¾“ã€å‰åç«¯æ•°æ®äº¤äº’ç­‰ã€‚Json ä¹Ÿè¢«å¹¿æ³›åº”ç”¨äºç§»åŠ¨åº”ç”¨å¼€å‘ã€å¤§æ•°æ®å¤„ç†ç­‰é¢†åŸŸã€‚ç”±äº Json æ ¼å¼ç®€å•æ˜“ç”¨ä¸”æ˜“äºé˜…è¯»ï¼Œå› æ­¤å®ƒéå¸¸å¸¸è§ï¼Œå¹¶ä¸”æˆä¸ºäº†è®¸å¤šåº”ç”¨ç¨‹åºä¸­æ•°æ®äº¤æ¢çš„æ ‡å‡†æ ¼å¼ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>è‹¥æˆ‘ä»¬æƒ³è¦å®ç° Json è§£æå™¨ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ <a href="https://www.json.org/json-zh.html" target="_blank" rel="noopener noreffer">Json æ ‡å‡†åè®®</a>ï¼Œå¯çœ‹åˆ°æ ‡å‡†ä¸­ä¸»è¦æ‹†åˆ†ä¸ºä»¥ä¸‹ 6 ä¸ªéƒ¨åˆ†ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">Json æ ‡æ³¨</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">å…·ä½“å®šä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ç©ºç™½whitespace</td>
<td style="text-align:left">ç©ºç™½ï¼ˆwhitespaceï¼‰å¯ä»¥æ’å…¥åœ¨ä»»ä½•ä¸€å¯¹æ ‡è®°ä¹‹é—´</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM5YzlkZjJjYzkzNWYyZjVmODU1NDU1YWQzZDYwYmZfb3NxbkprZVF5QnBhWElKTXkzSFlhRDQxbE9abUwwR25fVG9rZW46Q3dWTGIzRlA4b2FHc1p4QW1FZGMzYzBsbmFlXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM5YzlkZjJjYzkzNWYyZjVmODU1NDU1YWQzZDYwYmZfb3NxbkprZVF5QnBhWElKTXkzSFlhRDQxbE9abUwwR25fVG9rZW46Q3dWTGIzRlA4b2FHc1p4QW1FZGMzYzBsbmFlXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM5YzlkZjJjYzkzNWYyZjVmODU1NDU1YWQzZDYwYmZfb3NxbkprZVF5QnBhWElKTXkzSFlhRDQxbE9abUwwR25fVG9rZW46Q3dWTGIzRlA4b2FHc1p4QW1FZGMzYzBsbmFlXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM5YzlkZjJjYzkzNWYyZjVmODU1NDU1YWQzZDYwYmZfb3NxbkprZVF5QnBhWElKTXkzSFlhRDQxbE9abUwwR25fVG9rZW46Q3dWTGIzRlA4b2FHc1p4QW1FZGMzYzBsbmFlXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM5YzlkZjJjYzkzNWYyZjVmODU1NDU1YWQzZDYwYmZfb3NxbkprZVF5QnBhWElKTXkzSFlhRDQxbE9abUwwR25fVG9rZW46Q3dWTGIzRlA4b2FHc1p4QW1FZGMzYzBsbmFlXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
<tr>
<td style="text-align:left">æ•°å€¼number</td>
<td style="text-align:left">æ•°å€¼ï¼ˆnumberï¼‰éå¸¸ç±»ä¼¼äº C æˆ– Java æ•°å­—ï¼Œåªæ˜¯ä¸ä½¿ç”¨å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶æ ¼å¼</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY2ZjNmYTBlZGQxNDFkN2EwN2FjOWU3Nzg0OTZhMDdfb1h3YWZLSGxFQkozdDd0cjNhMkVsaUhHbkIzTFltY3RfVG9rZW46T0xyMWJkenl0bzVHM3F4alo0WmNRRVZqbkpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY2ZjNmYTBlZGQxNDFkN2EwN2FjOWU3Nzg0OTZhMDdfb1h3YWZLSGxFQkozdDd0cjNhMkVsaUhHbkIzTFltY3RfVG9rZW46T0xyMWJkenl0bzVHM3F4alo0WmNRRVZqbkpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY2ZjNmYTBlZGQxNDFkN2EwN2FjOWU3Nzg0OTZhMDdfb1h3YWZLSGxFQkozdDd0cjNhMkVsaUhHbkIzTFltY3RfVG9rZW46T0xyMWJkenl0bzVHM3F4alo0WmNRRVZqbkpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY2ZjNmYTBlZGQxNDFkN2EwN2FjOWU3Nzg0OTZhMDdfb1h3YWZLSGxFQkozdDd0cjNhMkVsaUhHbkIzTFltY3RfVG9rZW46T0xyMWJkenl0bzVHM3F4alo0WmNRRVZqbkpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY2ZjNmYTBlZGQxNDFkN2EwN2FjOWU3Nzg0OTZhMDdfb1h3YWZLSGxFQkozdDd0cjNhMkVsaUhHbkIzTFltY3RfVG9rZW46T0xyMWJkenl0bzVHM3F4alo0WmNRRVZqbkpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
<tr>
<td style="text-align:left">å­—ç¬¦ä¸²string</td>
<td style="text-align:left">ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆstringï¼‰æ˜¯ç”±ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„é›¶ä¸ªæˆ–å¤šä¸ª Unicode å­—ç¬¦ç»„æˆçš„åºåˆ—ï¼Œä½¿ç”¨åæ–œæ è½¬ä¹‰ã€‚ä¸€ä¸ªå­—ç¬¦ï¼ˆcharacterï¼‰å³ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ï¼ˆcharacter stringï¼‰</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUzMjUzNjA2MjkyODdhZWYwZGNlMjY3YTZjODBhYjlfR1VYbWNTT0xHbmtJSGpBN1AyYmlkMmMwM2dIWEh4aExfVG9rZW46TXNQZGJJWExRb0ZPdjB4U2NVMWM0YzlxbnVkXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUzMjUzNjA2MjkyODdhZWYwZGNlMjY3YTZjODBhYjlfR1VYbWNTT0xHbmtJSGpBN1AyYmlkMmMwM2dIWEh4aExfVG9rZW46TXNQZGJJWExRb0ZPdjB4U2NVMWM0YzlxbnVkXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUzMjUzNjA2MjkyODdhZWYwZGNlMjY3YTZjODBhYjlfR1VYbWNTT0xHbmtJSGpBN1AyYmlkMmMwM2dIWEh4aExfVG9rZW46TXNQZGJJWExRb0ZPdjB4U2NVMWM0YzlxbnVkXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUzMjUzNjA2MjkyODdhZWYwZGNlMjY3YTZjODBhYjlfR1VYbWNTT0xHbmtJSGpBN1AyYmlkMmMwM2dIWEh4aExfVG9rZW46TXNQZGJJWExRb0ZPdjB4U2NVMWM0YzlxbnVkXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDUzMjUzNjA2MjkyODdhZWYwZGNlMjY3YTZjODBhYjlfR1VYbWNTT0xHbmtJSGpBN1AyYmlkMmMwM2dIWEh4aExfVG9rZW46TXNQZGJJWExRb0ZPdjB4U2NVMWM0YzlxbnVkXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
<tr>
<td style="text-align:left">å€¼value</td>
<td style="text-align:left">å€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼ˆstringï¼‰ã€æ•°å€¼(number)ã€trueã€falseã€ nullã€å¯¹è±¡ï¼ˆobjectï¼‰æˆ–è€…æ•°ç»„ï¼ˆarrayï¼‰ã€‚å¹¶ä¸”è¿™äº›ç»“æ„å¯ä»¥åµŒå¥—</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJhNTdiNGZhMWNlNmRkM2Q5NDVjZmU4MWExZDExYjhfSHQ5eHhBTlBlZ1NKVG5hRU1TZG9ybU1IRTFUNlh4NnZfVG9rZW46REZGOWJSdXVzb2VYRGR4enlvWWNOQlhBbmpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJhNTdiNGZhMWNlNmRkM2Q5NDVjZmU4MWExZDExYjhfSHQ5eHhBTlBlZ1NKVG5hRU1TZG9ybU1IRTFUNlh4NnZfVG9rZW46REZGOWJSdXVzb2VYRGR4enlvWWNOQlhBbmpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJhNTdiNGZhMWNlNmRkM2Q5NDVjZmU4MWExZDExYjhfSHQ5eHhBTlBlZ1NKVG5hRU1TZG9ybU1IRTFUNlh4NnZfVG9rZW46REZGOWJSdXVzb2VYRGR4enlvWWNOQlhBbmpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJhNTdiNGZhMWNlNmRkM2Q5NDVjZmU4MWExZDExYjhfSHQ5eHhBTlBlZ1NKVG5hRU1TZG9ybU1IRTFUNlh4NnZfVG9rZW46REZGOWJSdXVzb2VYRGR4enlvWWNOQlhBbmpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJhNTdiNGZhMWNlNmRkM2Q5NDVjZmU4MWExZDExYjhfSHQ5eHhBTlBlZ1NKVG5hRU1TZG9ybU1IRTFUNlh4NnZfVG9rZW46REZGOWJSdXVzb2VYRGR4enlvWWNOQlhBbmpmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
<tr>
<td style="text-align:left">æ•°ç»„array</td>
<td style="text-align:left">æ•°ç»„ï¼ˆarrayï¼‰æ˜¯å€¼ï¼ˆvalueï¼‰çš„æœ‰åºé›†åˆã€‚ä¸€ä¸ªæ•°ç»„ä»¥å·¦ä¸­æ‹¬å·<code>[</code>å¼€å§‹ä¸”ä»¥å³ä¸­æ‹¬å·<code>]</code>ç»“æŸï¼Œå€¼ä¹‹é—´ä½¿ç”¨é€—å·<code>,</code>åˆ†éš”</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjVlZmYyMTcxMWQyNTNmZDA3NWVkYjI0MzI0YmJjNGFfUVR4c1VQTzQxdmloRHRoekJ6akpEdEVzdktOa0tSckJfVG9rZW46TUdxMWJ0R01vb0NEZUl4czMyTWNOWXlzbkFmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjVlZmYyMTcxMWQyNTNmZDA3NWVkYjI0MzI0YmJjNGFfUVR4c1VQTzQxdmloRHRoekJ6akpEdEVzdktOa0tSckJfVG9rZW46TUdxMWJ0R01vb0NEZUl4czMyTWNOWXlzbkFmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjVlZmYyMTcxMWQyNTNmZDA3NWVkYjI0MzI0YmJjNGFfUVR4c1VQTzQxdmloRHRoekJ6akpEdEVzdktOa0tSckJfVG9rZW46TUdxMWJ0R01vb0NEZUl4czMyTWNOWXlzbkFmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjVlZmYyMTcxMWQyNTNmZDA3NWVkYjI0MzI0YmJjNGFfUVR4c1VQTzQxdmloRHRoekJ6akpEdEVzdktOa0tSckJfVG9rZW46TUdxMWJ0R01vb0NEZUl4czMyTWNOWXlzbkFmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=MjVlZmYyMTcxMWQyNTNmZDA3NWVkYjI0MzI0YmJjNGFfUVR4c1VQTzQxdmloRHRoekJ6akpEdEVzdktOa0tSckJfVG9rZW46TUdxMWJ0R01vb0NEZUl4czMyTWNOWXlzbkFmXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
<tr>
<td style="text-align:left">å¯¹è±¡object</td>
<td style="text-align:left">å¯¹è±¡ï¼ˆobjectï¼‰æ˜¯ä¸€ä¸ªæ— åºçš„åç§°/å€¼å¯¹é›†åˆã€‚ä¸€ä¸ªå¯¹è±¡ä»¥å·¦æ‹¬å·<code>{</code>å¼€å§‹ï¼Œå³æ‹¬å·<code>}</code>ç»“æŸã€‚æ¯ä¸ªåç§°åè·Ÿä¸€ä¸ªå†’å·<code>:</code> ï¼Œä¸”åç§°/å€¼å¯¹ä¹‹é—´ä½¿ç”¨é€—å·<code>,</code>åˆ†éš”</td>
<td style="text-align:left"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBkYjVjNmU4MGM2MjFjZmE5N2M3ZmM3MDdhNmZlZjJfMjJCTkFHWkMwb0ludVMwdXF6S0RuUzEzem9UZ1RjazlfVG9rZW46RzJZRWJhYTE5b0o0SmZ4bGtGY2NWM3RtbjdjXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        data-srcset="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBkYjVjNmU4MGM2MjFjZmE5N2M3ZmM3MDdhNmZlZjJfMjJCTkFHWkMwb0ludVMwdXF6S0RuUzEzem9UZ1RjazlfVG9rZW46RzJZRWJhYTE5b0o0SmZ4bGtGY2NWM3RtbjdjXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBkYjVjNmU4MGM2MjFjZmE5N2M3ZmM3MDdhNmZlZjJfMjJCTkFHWkMwb0ludVMwdXF6S0RuUzEzem9UZ1RjazlfVG9rZW46RzJZRWJhYTE5b0o0SmZ4bGtGY2NWM3RtbjdjXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 1.5x, https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBkYjVjNmU4MGM2MjFjZmE5N2M3ZmM3MDdhNmZlZjJfMjJCTkFHWkMwb0ludVMwdXF6S0RuUzEzem9UZ1RjazlfVG9rZW46RzJZRWJhYTE5b0o0SmZ4bGtGY2NWM3RtbjdjXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA 2x"
        data-sizes="auto"
        alt="https://jih9axn4gg.feishu.cn/space/api/box/stream/download/asynccode/?code=YzBkYjVjNmU4MGM2MjFjZmE5N2M3ZmM3MDdhNmZlZjJfMjJCTkFHWkMwb0ludVMwdXF6S0RuUzEzem9UZ1RjazlfVG9rZW46RzJZRWJhYTE5b0o0SmZ4bGtGY2NWM3RtbjdjXzE3MDYyNzI5NDQ6MTcwNjI3NjU0NF9WNA"
        title="img" /></td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹åˆ°åœ¨ <a href="https://www.json.org/json-zh.html" target="_blank" rel="noopener noreffer">Json æ ‡å‡†åè®®</a> ä¸­ï¼Œå…¶<strong>æ•°æ®ç±»å‹çš„å®šä¹‰å’Œå…·ä½“è§£ææƒ…å†µéƒ½éå¸¸æ¸…æ™°å’Œè¾ƒä¸ºç®€å•</strong>ã€‚</p>
<p>ä¸‹é¢ä¼šæ ¹æ®å…¶æ ‡å‡†ï¼Œåˆ†åˆ«é€šè¿‡å‰é¢äº†è§£åˆ°çš„ nom å’Œ pest ç®€å•å®ç°ï¼Œå…·ä½“ä»£ç è·¯å¾„åœ¨ <a href="https://github.com/catwithtudou/parser_toy/tree/main/src/nom/json" target="_blank" rel="noopener noreffer">nom/json</a> å’Œ <a href="https://github.com/catwithtudou/parser_toy/tree/main/src/pest/json" target="_blank" rel="noopener noreffer">pest/json</a> ä¸­ã€‚</p>
<h1 id="åŸºäº-nom-å®ç°">åŸºäº nom å®ç°</h1>
<h2 id="json-model">Json Model</h2>
<p>è¿™é‡Œæˆ‘ä»¬<strong>ä½¿ç”¨ä¸€ä¸ªæšä¸¾</strong>æ¥ä»£è¡¨é™¤ç©ºç™½å¤–çš„ <strong>Json Value</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="cp">#[derive(Debug, PartialEq)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">JsonValue</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Str</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Boolean</span><span class="p">(</span><span class="kt">bool</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Num</span><span class="p">(</span><span class="kt">f64</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Array</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="o">&gt;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="p">(</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&gt;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Null</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…·ä½“ç±»å‹è§£æ">å…·ä½“ç±»å‹è§£æ</h2>
<ol>
<li><strong>ç©ºç™½</strong></li>
</ol>
<p>ä»å‰é¢ä¸­å¯çœ‹åˆ°<strong>ç©ºç™½å…ƒç´ åˆ†ä¸ºä»¥ä¸‹æƒ…å†µçš„ä»»æ„ä¸€ä¸ª</strong>ï¼Œå¤„ç†æ—¶ä¼šæ¶ˆè€—è¾“å…¥ç›´è‡³é‡åˆ°å…¶ä»–å…ƒç´ ï¼Œæœ€ç»ˆå¾—åˆ° whitespaceï¼š</p>
<ul>
<li>space-&gt;<code>&quot; &quot;</code></li>
<li>linefeed-&gt;<code>&quot;\n&quot;</code></li>
<li>carriage return-&gt;<code>&quot;\r&quot;</code></li>
<li>horizontal tab-&gt;<code>&quot;\t&quot;</code></li>
</ul>
<p>è¿™é‡Œ nom æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§å¯ç›´æ¥ä½¿ç”¨å†…ç½®å‡½æ•°<code>multispace0</code>ï¼Œä¸€ç§æ˜¯åˆ©ç”¨<code>take_while</code>æ„å»ºè§£æå‡½æ•°ï¼š</p>
<blockquote>
<p>å‰æ–‡å¯äº†è§£åˆ°<code>take_while</code>ä½œä¸ºè°“è¯è§£æå™¨æŒç»­æ¶ˆè€—è¾“å…¥ï¼Œç›´åˆ°å…¶è¾“å…¥ä¸æ»¡è¶³è°“è¯ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// whitespace Json ç©ºæ ¼è§£æï¼ˆç­‰ä»·äº nom å†…ç½®å‡½æ•° multispace0ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">whitespace</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34; </span><span class="se">\t\r\n</span><span class="s">&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">take_while</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">chars</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">c</span><span class="p">))(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>æ•°å€¼</strong></li>
</ol>
<p>ä»å‰é¢å¯ä»¥çœ‹åˆ°å¯¹äºæ•°å€¼ï¼ŒJson æ˜¯æ”¯æŒæ­£è´Ÿæ•°ã€å°æ•°å’Œç§‘å­¦è®¡æ•°æ³•ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>alt</code>å’Œ<code>be_f64</code>ç­‰è§£æå™¨å­ç»„åˆè¿›è¡Œè§£æï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ­¤åœºæ™¯æ›´å¸¸ç”¨çš„æ˜¯<strong>ä½¿ç”¨ nom æä¾›çš„å†…ç½®å‡½æ•°</strong> <strong><code>double</code></strong>ï¼Œå…¶ä½¿ç”¨æ–¹å¼å¯å‚è€ƒç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">nom</span>::<span class="n">number</span>::<span class="n">complete</span>::<span class="n">double</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">double</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;1.1&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.1</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;123E-02&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.23</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;123K-01&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;K-01&#34;</span><span class="p">,</span><span class="w"> </span><span class="mf">123.0</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;abc&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="nb">Err</span>::<span class="n">Error</span><span class="p">((</span><span class="s">&#34;abc&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorKind</span>::<span class="n">Float</span><span class="p">))));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>å­—ç¬¦ä¸²</strong></li>
</ol>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«è®¨è®ºå­—ç¬¦ä¸²å’Œä¸¤è¾¹å¼•å·ä¸­çš„å­—ç¬¦ä¸²çš„æƒ…å†µï¼š</p>
<ul>
<li>é¦–å…ˆå¯çœ‹åˆ°åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œåœ¨å·¦å¼•å·å³è¾¹æœ‰ä¸‰ç§æƒ…å†µï¼Œé™¤äº†å¼•å·ä¹‹é—´ä¸ºç©ºç™½çš„ç©ºå­—ç¬¦æƒ…å†µå¤–ï¼Œ<strong>å…¶ä½™æƒ…å†µå¯é€šè¿‡ç»„åˆå™¨æ¥å»æ‰ä¸¤è¾¹å¼•å·ï¼Œè·å–åˆ°ä¸¤è¾¹å¼•å·ä¸­çš„å­—ç¬¦ä¸²çš„å†…å®¹</strong>ï¼Œå…¶ä¸­ç»„åˆå™¨çš„ä½¿ç”¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ºå¸¸è§çš„ä¸¤ç§ä½¿ç”¨æ€è·¯ï¼š
<ul>
<li><code>alt</code>+<code>delimited</code>ï¼šæŒ‰<strong>å­—ç¬¦æ•´ä½“ç»“æ„çš„æ€è·¯</strong>å»è§£æ</li>
<li><code>preceded</code>+<code>cut</code>+<code>terminated</code>ï¼šæŒ‰<strong>å­—ç¬¦é¡ºåºçš„æ€è·¯</strong>å»è§£æ</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// string æ•´ä¸ªå­—ç¬¦ä¸²è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">string</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">preceded</span><span class="p">(</span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;\&#34;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">terminated</span><span class="p">(</span><span class="n">parse_str</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;\&#34;&#39;</span><span class="p">)))))(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// parse_str åç»­ä¼šæè¿°å…¶å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">string</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">alt</span><span class="p">((</span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;\&#34;</span><span class="s">&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">delimited</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;</span><span class="s">&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">parse_str</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;</span><span class="s">&#34;</span><span class="p">)))),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å…¶ä¸­<code>cut</code>ç»„åˆå™¨çš„çš„ä½œç”¨æ˜¯é˜»æ­¢å›æº¯ï¼ˆbacktrackingï¼‰ï¼Œå®ƒä¼šåœ¨è§£æå¤±è´¥æ—¶ç«‹å³åœæ­¢è§£æï¼Œè€Œä¸ä¼šå°è¯•å…¶ä»–å¯èƒ½çš„è§£æè·¯å¾„ã€‚è¿™å¯¹äºé¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€å’Œè§£æé”™è¯¯éå¸¸æœ‰ç”¨ã€‚è¿™é‡Œç»™å‡ºå®˜æ–¹çš„ç¤ºä¾‹æ–¹ä¾¿ç†è§£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">nom</span>::<span class="n">combinator</span>::<span class="n">cut</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">parser</span><span class="p">(</span><span class="n">input</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">alt</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">preceded</span><span class="p">(</span><span class="n">one_of</span><span class="p">(</span><span class="s">&#34;+-&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">digit1</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">rest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">))(</span><span class="n">input</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;+10 ab&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34; ab&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;10&#34;</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;ab&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;ab&#34;</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">parser</span><span class="p">(</span><span class="s">&#34;+&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="nb">Err</span>::<span class="n">Failure</span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">input</span>: <span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">code</span>: <span class="nc">ErrorKind</span>::<span class="n">Digit</span><span class="w"> </span><span class="p">})));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<ul>
<li>ç„¶åè·å–åˆ°å¼•å·ä¸­çš„å­—ç¬¦ä¸²åï¼Œæˆ‘ä»¬éœ€è¦<strong>å¤„ç†è½¬ä¹‰å­—ç¬¦æ‰èƒ½è·å–åˆ°å®é™…å†…å®¹</strong>ï¼Œç›®å‰ nom å†…ç½®æä¾›äº†<strong>ä¸“é—¨å¤„ç†è½¬ä¹‰å­—ç¬¦çš„</strong> <strong><code>escaped</code></strong> <strong>å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°å…¥å‚ä¸º <code>escaped(normal, control, escapable)</code>ï¼Œå…¶å‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼š
<ul>
<li><code>normal</code> ï¼šç”¨äºåŒ¹é…æ™®é€šå­—ç¬¦è§£æå™¨ï¼Œä½†æ— æ³•æ¥å—å«æœ‰æ§åˆ¶ç¬¦çš„å­—ç¬¦</li>
<li><code>control</code>ï¼šæ§åˆ¶å­—ç¬¦ï¼ˆä¾‹å¦‚åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ä½¿ç”¨çš„<code>\</code>ï¼‰</li>
<li><code>escapable</code>ï¼šå¯åŒ¹é…çš„è½¬ä¹‰å­—ç¬¦</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// å®˜æ–¹ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">nom</span>::<span class="n">bytes</span>::<span class="n">complete</span>::<span class="n">escaped</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">nom</span>::<span class="n">character</span>::<span class="n">complete</span>::<span class="n">one_of</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">esc</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// digit1:å³å†…ç½®è§£æå™¨å‡½æ•°ï¼Œè¡¨ç¤ºåŒ¹é…è‡³å°‘ä¸€ä¸ªæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="c1">// &#39;\\&#39;:è¡¨ç¤ºåæ–œæ å­—ç¬¦&#39;\&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="c1">// r#&#34;&#34;n\&#34;#:é€šè¿‡ã€Œr#&#34;{æ„é€ åŸå§‹å­—ç¬¦ä¸²å­—é¢é‡çš„å­—ç¬¦ä¸²å†…å®¹}&#34;#ã€ï¼Œè¿™é‡Œè¡¨ç¤ºå¯åŒ¹é…çš„è½¬ä¹‰å­—ç¬¦æœ‰ &#34;ã€nã€\
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="n">escaped</span><span class="p">(</span><span class="n">digit1</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;\\&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">one_of</span><span class="p">(</span><span class="sa">r</span><span class="s">#&#34;&#34;n\&#34;#</span><span class="p">))(</span><span class="n">s</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">esc</span><span class="p">(</span><span class="s">&#34;123;&#34;</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;;&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;123&#34;</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">esc</span><span class="p">(</span><span class="sa">r</span><span class="s">#&#34;12\&#34;34;&#34;#</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">((</span><span class="s">&#34;;&#34;</span><span class="p">,</span><span class="w"> </span><span class="sa">r</span><span class="s">#&#34;12\&#34;34&#34;#</span><span class="p">)));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æœ€åæ ¹æ®<code>escaped</code>å‡½æ•°å’Œ Json æ ‡å‡†æ„é€ <code>parse_str</code>å‡½æ•°ï¼Œå…¶ä¸­åœ¨æ­¤åœºæ™¯å¡«å†™çš„ä¸‰ä¸ªå‚æ•°çš„æ„æ€åˆ†åˆ«ä¸ºï¼š
<ul>
<li><code>normal</code>ï¼šåŒ¹é…&quot;Any codepoint except &quot; or \ or control characters&quot;</li>
<li><code>'\\'</code>ï¼šJson ä¸­çš„è½¬ä¹‰å­—ç¬¦åŒæ ·ä¹Ÿæ˜¯åæ–œæ å­—ç¬¦</li>
<li><code>escapable</code>ï¼šåŒ¹é…æ ‡å‡†æè¿°ä¸­çš„<code>&quot;,\,/,b</code>ç­‰ï¼Œéœ€è¦æ³¨æ„åå…­è¿›åˆ¶æ•°å­—ä¹Ÿéœ€è¦å•ç‹¬å¤„ç†
<ul>
<li>è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸€ä¸‹åå…­è¿›åˆ¶å¤„ç†ä½¿ç”¨åˆ°çš„<code>peek</code>å†…ç½®å‡½æ•°å³è§£æåä¸æ¶ˆè€—è¾“å…¥ï¼Œä½¿åé¢è§£ææ­£å¸¸</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// parse_str å•ç‹¬å­—ç¬¦ä¸²è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">parse_str</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">escaped</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;\\&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">escapable</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// normal æ™®é€šå­—ç¬¦è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">normal</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">take_till1</span><span class="p">(</span><span class="o">|</span><span class="n">c</span>: <span class="kt">char</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\\&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">is_ascii_control</span><span class="p">())(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// escapable è½¬ä¹‰å­—ç¬¦è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">escapable</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;escaped&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">alt</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;</span><span class="s">&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\\</span><span class="s">&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;b&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;f&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;n&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;r&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;t&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">hex</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)))(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// hex  åå…­è¿›åˆ¶å­—ç¬¦è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">hex</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;hex&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">preceded</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">peek</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;u&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">take_while_m_n</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">c</span>: <span class="kt">char</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">is_ascii_hexdigit</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;u&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">))(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>å€¼</strong></li>
</ol>
<p>å‰é¢å·²ç»å®ç°äº†ç©ºç™½ã€æ•°å­—ã€å­—ç¬¦ä¸²çš„è§£æå™¨ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆå®Œæˆ<strong>åŸºæœ¬ç±»å‹ boolean å’Œ nullï¼š</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// boolean å¸ƒå°”æ•°æ®ç±»å‹è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">boolean</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">alt</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">value</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;true&#34;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">value</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;false&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">))(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// null Nullè§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">null</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">map</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;null&#34;</span><span class="p">),</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Null</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç›®å‰æ ¹æ®å®ç°å¥½çš„ç±»å‹è§£æå™¨ï¼Œæˆ‘ä»¬å¯ä»¥<strong>æ„é€ å‡ºå€¼çš„è§£æå™¨ï¼ˆå¤åˆç±»å‹åé¢å®ç°ï¼‰</strong>ï¼š</p>
<blockquote>
<p>ä¸‹é¢å®ç°ä¸­æœ‰ä¸€ä¸ªå¯èƒ½æ¯”è¾ƒéš¾ç†è§£çš„è¯­æ³•ï¼Œè¿™é‡Œç®€å•è¯´æ˜ä¸‹ï¼š</p>
<ul>
<li><code>map</code>å‡½æ•°çš„å…¥å‚ç±»å‹åˆ†åˆ«æ˜¯ nom parser trait å’Œé—­åŒ…å‡½æ•°*<code>FnMut</code>*<code>(O1) -&gt; O2</code></li>
<li>è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æšä¸¾ç±»å‹çš„å…ƒç´ çš„æ„é€ å‡½æ•°æœ¬èº«å°±æ˜¯å¦‚ä¸Šçš„åŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥å¯ç›´æ¥ä½¿ç”¨</li>
</ul>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// json_value JsonValue è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">json_value</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;json value&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">delimited</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">whitespace</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">alt</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Str</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="n">s</span><span class="p">))),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="n">double</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Num</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="n">boolean</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Boolean</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">null</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Array</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Object</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">whitespace</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>æ•°ç»„</strong></li>
</ol>
<p>æ ¹æ®æ•°ç»„çš„æ ‡å‡†æè¿°ï¼š</p>
<ul>
<li>é¦–å…ˆä½¿ç”¨<code>delimited</code>æ¥å»æ‰å·¦å³æ–¹æ‹¬å·åï¼Œæ–¹ä¾¿è§£æä¹‹é—´çš„å†…å®¹</li>
<li>åˆ©ç”¨<strong>å†…ç½®å‡½æ•°</strong> <strong><code>separated_list0</code></strong> <strong>æ¥è§£ææ‹¬å·åŒ…å«å†…å®¹å¾—åˆ°æ•°ç»„</strong> <strong><code>Vec&lt;JsonValue&gt;</code></strong>ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// array æ•°ç»„è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">array</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">delimited</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;[&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">separated_list0</span><span class="p">(</span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">delimited</span><span class="p">(</span><span class="n">whitespace</span><span class="p">,</span><span class="w"> </span><span class="n">json_value</span><span class="p">,</span><span class="w"> </span><span class="n">whitespace</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">tag</span><span class="p">(</span><span class="s">&#34;]&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>å¯¹è±¡</strong></li>
</ol>
<p>å¯¹äºåƒå¯¹è±¡è¿™æ ·å¤æ‚çš„è§£æå™¨ï¼Œé€šè¿‡ç»„åˆå™¨è§£æå™¨çš„æ€æƒ³ï¼Œæˆ‘ä»¬å¯<strong>é€šè¿‡æ‹†åˆ†å­è§£æå™¨çš„æ–¹å¼</strong>æ¥åˆ†åˆ«å®ç°ï¼š</p>
<ul>
<li>é¦–å…ˆé’ˆå¯¹å¯¹è±¡ä¸­çš„<strong>åç§°/å€¼å¯¹çš„æ ¼å¼</strong>è¿›è¡Œè§£æï¼Œä½¿ç”¨<code>separated_pair</code>+<code>preceded</code>çš„ç»„åˆï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// key_value kvæ ¼å¼è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">key_value</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">separated_pair</span><span class="p">(</span><span class="n">preceded</span><span class="p">(</span><span class="n">whitespace</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">),</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">preceded</span><span class="p">(</span><span class="n">whitespace</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">))),</span><span class="w"> </span><span class="n">json_value</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç„¶åé’ˆå¯¹<strong>å¯¹è±¡çš„æ•´ä½“ç»“æ„</strong>ï¼Œå…¶è§£ææ€è·¯ä¸ºï¼š
<ul>
<li>å·¦æ‹¬å·-&gt;æ‹¬å·ä¸­å†…å®¹-&gt;æŒ‰ï¼ˆå‰é¢å·²å®ç°çš„ï¼‰é”®å€¼å¯¹æ ¼å¼è§£ææ„é€ æ•°ç»„-&gt;æ•°ç»„è½¬æ¢ä¸ºHashMap çš„ç±»å‹-&gt;å³æ‹¬å·</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="c1">// object å¯¹è±¡æ ¼å¼è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span> <span class="nf">object</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">context</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">preceded</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cut</span><span class="p">(</span><span class="n">terminated</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">map</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">separated_list0</span><span class="p">(</span><span class="n">preceded</span><span class="p">(</span><span class="n">whitespace</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">)),</span><span class="w"> </span><span class="n">key_value</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="o">|</span><span class="n">tuple_vec</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">tuple_vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="p">)).</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">preceded</span><span class="p">(</span><span class="n">whitespace</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">(</span><span class="sc">&#39;}&#39;</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é¡¶å±‚è§£æå‡½æ•°">é¡¶å±‚è§£æå‡½æ•°</h2>
<p>å‰é¢æˆ‘ä»¬å·²å®ç° Json æ ‡å‡†ä¸­æ‰€æœ‰çš„æ ‡æ³¨ç±»å‹ï¼Œæœ€åæˆ‘ä»¬åªéœ€è¦æ„é€ é¡¶å±‚çš„å‡½æ•°æ¥ä½¿ç”¨è¯¥è§£æå™¨ã€‚</p>
<p>è¿™é‡Œ Json çš„æœ€å¤–å±‚ç»“æœå…è®¸è¦ä¹ˆæ˜¯å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é¡¶å±‚å‡½æ•°ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">root</span><span class="p">(</span><span class="n">i</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">IResult</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">delimited</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">whitespace</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">alt</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">map</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Object</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">map</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Array</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">opt</span><span class="p">(</span><span class="n">whitespace</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åä½ å¯è¿è¡Œä¸‹é¢æµ‹è¯•å‡½æ•°æ¥çœ‹çœ‹æœ€ç»ˆçš„è¿”å›ç»“æœæ˜¯å¦æ­£å¸¸ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="cp">#[cfg(test)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">mod</span> <span class="nn">test_json</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">nom</span>::<span class="n">json</span>::<span class="n">json</span>::<span class="n">root</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">test_parse_json</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;  { </span><span class="se">\&#34;</span><span class="s">a</span><span class="se">\&#34;\t</span><span class="s">: 42,
</span></span></span><span class="line"><span class="cl"><span class="s">  </span><span class="se">\&#34;</span><span class="s">b</span><span class="se">\&#34;</span><span class="s">: [ </span><span class="se">\&#34;</span><span class="s">x</span><span class="se">\&#34;</span><span class="s">, </span><span class="se">\&#34;</span><span class="s">y</span><span class="se">\&#34;</span><span class="s">, 12 ] ,
</span></span></span><span class="line"><span class="cl"><span class="s">  </span><span class="se">\&#34;</span><span class="s">c</span><span class="se">\&#34;</span><span class="s">: { </span><span class="se">\&#34;</span><span class="s">hello</span><span class="se">\&#34;</span><span class="s"> : </span><span class="se">\&#34;</span><span class="s">world</span><span class="se">\&#34;</span><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">  } &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;will try to parse valid JSON data:</span><span class="se">\n\n</span><span class="s">**********</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s">**********</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// will try to parse valid JSON data:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     **********
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// { &#34;a&#34; : 42,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     &#34;b&#34;: [ &#34;x&#34;, &#34;y&#34;, 12 ] ,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     &#34;c&#34;: { &#34;hello&#34; : &#34;world&#34;}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// **********
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#34;parsing a valid file:</span><span class="se">\n</span><span class="si">{:#?}</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">root</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// parsing a valid file:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     Ok(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         (
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// &#34;&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// Object(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         &#34;c&#34;: Object(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             &#34;hello&#34;: Str(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             &#34;world&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         },
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         &#34;b&#34;: Array(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             [
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//                 Str(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         &#34;x&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         Str(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             &#34;y&#34;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         Num(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//             12.0,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ],
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         &#34;a&#34;: Num(
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         42.0,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//         ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     },
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// ),
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤é€šè¿‡ nom å®ç°çš„ Json è§£æå™¨å°±å®Œæˆäº†ã€‚è¿™é‡Œæ²¡æœ‰è¿›è¡Œå…·ä½“çš„æ€§èƒ½æµ‹è¯•ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‹æµ‹ä¸€ä¸‹ã€‚</p>
<h1 id="åŸºäº-pest-å®ç°">åŸºäº pest å®ç°</h1>
<h2 id="json-model-1">Json Model</h2>
<p>ä¸ nom å‰é¢çš„å®ç°ç±»ä¼¼ï¼Œè¿™é‡Œç”¨<strong>ä¸€ä¸ªæšä¸¾</strong>æ¥æ„å»ºé™¤ç©ºç™½å¤–çš„ <strong>Json Value</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="cp">#[derive(Debug, PartialEq)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">enum</span> <span class="nc">JsonValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Number</span><span class="p">(</span><span class="kt">f64</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">String</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">str</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Boolean</span><span class="p">(</span><span class="kt">bool</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Array</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;&gt;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Object</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">JsonValue</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Null</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…ä¸Š<strong>ä¹Ÿä¸ä¸€å®šè¦å£°æ˜ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œå¯ç›´æ¥ä½¿ç”¨ Stringï¼Œå£°æ˜çš„åŸå› æ˜¯å¼•å…¥äº†<code>&amp;str</code>ï¼Œè¿™æ ·å¯çœå»åé¢ç±»å‹è½¬æ¢å¤„ç†ã€‚</p>
<p>è€ƒè™‘åˆ°åé¢ Json è§£æåå¾—åˆ°çš„ JsonValue æ›´å¥½åœ°å±•ç¤ºå’Œå¤„ç†ï¼Œè¿™é‡Œå¢åŠ ä¸€ä¸ª<strong>é’ˆå¯¹ JsonValue çš„åºåˆ—åŒ–å™¨</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">serialize_json_value</span><span class="p">(</span><span class="n">val</span>: <span class="kp">&amp;</span><span class="nc">JsonValue</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="o">*</span><span class="p">;</span><span class="w"> </span><span class="c1">// æ–¹ä¾¿åç»­æšä¸¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Number</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nb">String</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;</span><span class="si">{}</span><span class="se">\&#34;</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Boolean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">contents</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">serialize_json_value</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;[</span><span class="si">{}</span><span class="s">]&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Object</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">contents</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;</span><span class="si">{}</span><span class="se">\&#34;</span><span class="s">:</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">serialize_json_value</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;</span><span class="se">{{</span><span class="si">{}</span><span class="se">}}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Null</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&#34;null&#34;</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­éœ€è¦æ³¨æ„ï¼Œåœ¨å¤„ç†æ•°ç»„å’Œå¯¹è±¡å¤åˆç±»å‹æ—¶ï¼Œéœ€è¦<strong>è¿›è¡Œé€’å½’</strong>æ‰èƒ½æ‹¿åˆ°å¤åˆç±»å‹ä¸‹çš„å…·ä½“å€¼ã€‚</p>
<h2 id="pest--grammar-è§£æ">Pest  Grammar è§£æ</h2>
<p>è¿™é‡Œæˆ‘ä»¬æ–°å»º<code>json.pest</code>æ¥ç”¨ Pest Grammar æ¥ç¼–å†™æˆ‘ä»¬éœ€è¦è§£æçš„ Json æ ‡å‡†ã€‚</p>
<ol>
<li><strong>ç©ºç™½</strong></li>
</ol>
<p>æ ¹æ®æ ‡å‡†æåˆ°çš„æè¿°ï¼Œé€šè¿‡å¯é€‰æ‹©æ“ä½œç¬¦<code>|</code>å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="nx">WHITESPACE</span> <span class="o">=</span> <span class="nx">_</span><span class="p">{</span> <span class="s2">&#34; &#34;</span> <span class="o">|</span> <span class="s2">&#34;\t&#34;</span> <span class="o">|</span> <span class="s2">&#34;\r&#34;</span> <span class="o">|</span> <span class="s2">&#34;\n&#34;</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œæœ‰å‡ ä¸ªçš„è¯­æ³•ç‰¹æ®Šå¤„ç†éœ€è¦å‰ç½®è¯´æ˜ä¸‹ï¼š</p>
<ul>
<li>è‹¥è§„åˆ™åŠ ä¸Šå‰ç¼€<code>_</code>åˆ™ä»£è¡¨åˆ›å»ºäº†ä¸€ä¸ªé™é»˜è§„åˆ™ï¼Œä¸æ™®é€šè§„åˆ™ä¸åŒçš„æ˜¯ï¼Œåœ¨è§£æè¿‡ç¨‹ä¸­<strong>ä¸ä¼šäº§ç”Ÿ  token pairs åŒæ—¶ä¹Ÿä¸ä¼šä¸ŠæŠ¥é”™è¯¯ï¼Œæœ€ç»ˆåªä¼šè·å–åˆ°æœ€å¤–å±‚çš„ä¸€å¯¹ token pair</strong></li>
<li>åœ¨ pest ä¸­è‹¥å•ç‹¬å®šä¹‰<code>WHITESPACE</code>ï¼Œåˆ™å®ƒä¼šè¢«<strong>éšå¼åœ°æ’å…¥åˆ°æ¯ä¸ª sequence æˆ– repetition ä¹‹é—´ï¼ˆé™¤åŸå­è§„åˆ™ï¼‰</strong>
<ul>
<li>è¿™é‡Œçš„æåˆ°çš„â€œé™¤åŸå­è§„åˆ™å¤–â€éœ€è¦æ³¨æ„ï¼Œåé¢ä¼šæœ‰è§„åˆ™å…³è”åˆ°è¿™ä¸ªä¿¡æ¯</li>
<li>ç±»ä¼¼çš„éšå¼çº¦å®šè¿˜æœ‰<code>COMMENT</code>è§„åˆ™ï¼Œéƒ½æ˜¯ pest å¯¹äºå­—ç¬¦å†…å®¹ä¸­éšå«ç©ºç™½åœºæ™¯çš„è€ƒè™‘å¤„ç†</li>
</ul>
</li>
</ul>
<p>ç»¼ä¸Šå¯çŸ¥ï¼Œåç»­æ–‡ä»¶ä¸­<strong>é™¤åŸå­è§„åˆ™å¤–çš„æ‰€æœ‰ sequence æˆ– repetition ä¹‹é—´è§£ææ—¶éƒ½ä¼šå¿½ç•¥ç©ºç™½</strong></p>
<ol>
<li><strong>æ•°å€¼</strong></li>
</ol>
<p>æ ¹æ®æ ‡å‡†æè¿°ï¼Œé€šè¿‡åºåˆ—è¿ç®—ç¬¦<code>~</code>æ¥åŠ å…¥è¡¨è¾¾å¼ä¸åŒçš„è§£ææ¡ä»¶ï¼Œä¸”å¯åˆ©ç”¨ pest ä¸­å¯¹æ•°å­—ç›¸å…³çš„å†…ç½®è§„åˆ™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 2. number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">number</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;-&#34;</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;0&#34;</span> <span class="o">|</span> <span class="nx">ASCII_NONZERO_DIGIT</span> <span class="o">~</span> <span class="nx">ASCII_DIGIT</span><span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;.&#34;</span> <span class="o">~</span> <span class="nx">ASCII_DIGIT</span><span class="o">*</span><span class="p">)</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span> <span class="p">(</span><span class="o">^</span><span class="s2">&#34;e&#34;</span> <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;+&#34;</span><span class="o">|</span><span class="s2">&#34;-&#34;</span><span class="p">)</span><span class="o">?</span> <span class="o">~</span> <span class="nx">ASCII_DIGIT</span><span class="o">+</span><span class="p">)</span><span class="o">?</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡ŒåŒæ ·å­˜åœ¨è¯­æ³•çš„ç‰¹æ®Šå¤„ç†éœ€è¦è§£é‡Šä¸‹ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼š</p>
<ul>
<li>è‹¥è§„åˆ™åŠ ä¸Šå‰ç¼€<code>@</code>åˆ™ä»£è¡¨åˆ›å»ºäº†ä¸€ä¸ª<strong>åŸå­è§„åˆ™</strong>ï¼Œå…¶å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š
<ul>
<li>ä¸ä¼šç”Ÿæ•ˆå‰é¢æåˆ°çš„<code>WHITESPACE</code>å¤„ç†ï¼Œå³<strong>ä¸ä¼šéšè—å†…éƒ¨ç©ºç™½</strong>ï¼Œä¸<code>~</code>æ„é€ çš„ sequence ä¹‹é—´ä¸ä¼šå¿½ç•¥å­—ç¬¦</li>
<li>åœ¨åŸå­è§„åˆ™ä¸­ï¼Œè°ƒç”¨çš„<strong>å…¶ä»–è§„åˆ™ä¹Ÿä¼šè¢«è§†ä¸ºåŸå­è§„åˆ™</strong></li>
<li>åœ¨åŸå­è§„åˆ™ä¸­ï¼Œ<strong>å†…éƒ¨åŒ¹é…çš„æ‰€æœ‰è§„åˆ™ä¼šè¢«è§†ä¸ºé™é»˜çš„</strong>ï¼Œå³åªèƒ½è·å–åˆ°æœ€å¤–å±‚çš„æ•´ä¸ªè§„åˆ™çš„è§£æç»“æœ</li>
</ul>
</li>
<li>åœ¨è§„åˆ™åç¼€åŠ ä¸Šè¿ç®—ç¬¦<code>?</code>ã€<code>*</code>ã€<code>+</code>ï¼Œåˆ™åˆ†åˆ«è¡¨ç¤º<strong>å¯åŒ¹é…è‡³å¤šä¸€ä¸ª</strong>ï¼Œ<strong>åŒ¹é…æ‰€æœ‰</strong>ï¼Œ<strong>åŒ¹é…è‡³å°‘ä¸€ä¸ªå­—ç¬¦</strong></li>
<li>åœ¨è§„åˆ™å‰ç¼€åŠ ä¸Šè¿ç®—ç¬¦<code>^</code>ï¼Œåˆ™è¯´æ˜<strong>ä¸åŒºåˆ†å¤§å°å†™</strong></li>
</ul>
<ol>
<li><strong>å­—ç¬¦ä¸²</strong></li>
</ol>
<p>æ ¹æ®æ ‡å‡†æè¿°ï¼Œæˆ‘ä»¬è¿™é‡Œå°†å­—ç¬¦ä¸²çš„è§£æç»“åˆä¸‰ä¸ªè§„åˆ™æ¥æ›´æ¸…æ™°åœ°è¯´æ˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 3. string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">string</span> <span class="o">=</span> <span class="nx">$</span><span class="p">{</span> <span class="s2">&#34;\&#34;&#34;</span> <span class="o">~</span> <span class="nx">inner</span> <span class="o">~</span> <span class="s2">&#34;\&#34;&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">inner</span> <span class="o">=</span> <span class="err">@</span><span class="p">{</span> <span class="nx">char</span><span class="o">*</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">char</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">!</span><span class="p">(</span> <span class="s2">&#34;\&#34;&#34;</span> <span class="o">|</span> <span class="s2">&#34;\\&#34;</span><span class="p">)</span> <span class="o">~</span> <span class="nx">ANY</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="s2">&#34;\\&#34;</span> <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;\&#34;&#34;</span> <span class="o">|</span> <span class="s2">&#34;\\&#34;</span> <span class="o">|</span> <span class="s2">&#34;/&#34;</span> <span class="o">|</span> <span class="s2">&#34;b&#34;</span> <span class="o">|</span> <span class="s2">&#34;f&#34;</span> <span class="o">|</span> <span class="s2">&#34;n&#34;</span> <span class="o">|</span> <span class="s2">&#34;r&#34;</span> <span class="o">|</span> <span class="s2">&#34;t&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="s2">&#34;\\&#34;</span> <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;u&#34;</span> <span class="o">~</span> <span class="nx">ASCII_HEX_DIGIT</span><span class="p">{</span><span class="mi">4</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>pest æ²¡æœ‰åƒ nom ä¸€æ ·æä¾›äº†å†…ç½®é’ˆå¯¹è½¬ä¹‰å­—ç¬¦çš„å¤„ç†å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨<strong>è§£ææ—¶éœ€è¦æ‰‹åŠ¨å¸¦ä¸Šè½¬ä¹‰ç¬¦å·</strong>ã€‚</p>
<p>è¿™é‡Œè§£é‡Šä¸‹å…¶ä¸­ç”¨åˆ°çš„è¯­æ³•ç‰¹æ®Šå¤„ç†ï¼š</p>
<ul>
<li>è‹¥è§„åˆ™åŠ ä¸Šå‰ç¼€<code>$</code>åˆ™ä»£è¡¨åˆ›å»ºäº†ä¸€ä¸ª<strong>å¤åˆåŸå­è§„åˆ™</strong>ï¼Œä¸å‰é¢åŸå­è§„åˆ™ç±»ä¼¼ä½†ä¹Ÿæœ‰åŒºåˆ«éœ€æ³¨æ„ï¼Œå…¶å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š
<ul>
<li>åŒæ ·ä¸ä¼šç”Ÿæ•ˆå‰é¢æåˆ°çš„<code>WHITESPACE</code>å¤„ç†</li>
<li>åœ¨å¤åˆåŸå­è§„åˆ™ä¸­ï¼Œä¸å­˜åœ¨å°†<strong>å…¶ä»–è§„åˆ™è§†ä¸ºåŸå­è§„åˆ™å’Œå†…éƒ¨åŒ¹é…è§„åˆ™è§†ä¸ºé™é»˜çš„å¤„ç†</strong>ï¼Œå…¶ä»–å‡ä¸æ™®é€šè§„åˆ™ç±»ä¼¼</li>
</ul>
</li>
<li><code>!(...) ~ ANY</code>ä»£è¡¨åŒ¹é…<strong>é™¤äº†æ‹¬å·ä¸­ç»™å‡ºçš„å­—ç¬¦ä¹‹å¤–</strong>çš„ä»»ä½•å­—ç¬¦</li>
</ul>
<ol>
<li><strong>å€¼</strong></li>
</ol>
<p>ä¸ä¹‹å‰å®ç°å€¼ç±»ä¼¼ï¼Œæˆ‘ä»¬å…ˆå®Œæˆ<strong>åŸºæœ¬ç±»å‹ boolean å’Œ null</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 4. boolean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">boolean</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;true&#34;</span> <span class="o">|</span> <span class="s2">&#34;false&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 5. null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kc">null</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;null&#34;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç»“åˆå„æ•°æ®ç±»å‹çš„è§£æè§„åˆ™æ„é€ å€¼</strong>ï¼Œè€ƒè™‘åˆ°åç»­ä¸å…³å¿ƒå€¼ä¸­ä¸åŒè§„åˆ™çš„è§£æè¿‡ç¨‹ï¼Œ<strong>æ‰€ä»¥æ ‡è®°</strong> <strong><code>_</code></strong> <strong>é™é»˜è§„åˆ™å‡å°‘åµŒå¥—</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="nx">value</span> <span class="o">=</span> <span class="nx">_</span><span class="p">{</span> <span class="kt">number</span> <span class="o">|</span> <span class="kt">string</span> <span class="o">|</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="nx">array</span> <span class="o">|</span> <span class="kt">object</span> <span class="o">|</span> <span class="kc">null</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­æ•°ç»„å’Œå¯¹è±¡æˆ‘ä»¬ä¸‹é¢æè¿°ã€‚</p>
<ol>
<li><strong>æ•°ç»„</strong></li>
</ol>
<p>æ ¹æ®æ ‡å‡†æè¿°ï¼Œè¿™é‡Œå°†ç©ºæ•°ç»„å’Œæœ‰å€¼æ•°ç»„åˆ†å¼€ï¼Œ<strong>é€šè¿‡</strong> <strong><code>~</code></strong> <strong>å’Œ</strong> <strong><code>\*</code></strong> <strong>æ¥è¡¨ç¤ºå¯èƒ½ä¼šå­˜åœ¨çš„å¤šä¸ªå€¼</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 6. array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">array</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;[&#34;</span> <span class="o">~</span> <span class="s2">&#34;]&#34;</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;[&#34;</span> <span class="o">~</span> <span class="nx">value</span> <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;,&#34;</span> <span class="o">~</span> <span class="nx">value</span><span class="p">)</span><span class="o">*</span> <span class="o">~</span> <span class="s2">&#34;]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>å¯¹è±¡</strong></li>
</ol>
<p>è¿™é‡Œå•ç‹¬å°†å¯¹è±¡å€¼æ‹†åˆ†æˆ pair è§„åˆ™ï¼Œ<strong>åˆ©ç”¨å‰é¢çš„å­—ç¬¦ä¸²å’Œå€¼è§„åˆ™</strong>ï¼Œåé¢ä¸æ•°ç»„ç±»ä¼¼å¤„ç†ï¼ŒåŒºåˆ†ç©ºå¯¹è±¡å’Œæœ‰å€¼å¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 7. object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">object</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;{&#34;</span> <span class="o">~</span> <span class="s2">&#34;}&#34;</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;{&#34;</span> <span class="o">~</span> <span class="nx">pair</span> <span class="o">~</span> <span class="p">(</span><span class="s2">&#34;,&#34;</span> <span class="o">~</span> <span class="nx">pair</span><span class="p">)</span><span class="o">*</span> <span class="o">~</span> <span class="s2">&#34;}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">pair</span> <span class="o">=</span> <span class="p">{</span> <span class="kt">string</span> <span class="o">~</span> <span class="s2">&#34;:&#34;</span> <span class="o">~</span> <span class="nx">value</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>æœ€ç»ˆè§„åˆ™</strong></li>
</ol>
<p>æœ€åæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ€ç»ˆè§„åˆ™æ¥è¡¨ç¤ºæ•´ä¸ª Jsonï¼Œè€Œ Json å†…å®¹å”¯ä¸€åˆæ³•çš„æ˜¯<strong>ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„</strong>ã€‚</p>
<p>åŒæ—¶è€ƒè™‘åˆ°åç»­æˆ‘ä»¬åªéœ€è¦<strong>è§£æåçš„å€¼æœ¬èº«ï¼Œä»¥åŠ EOI è§„åˆ™</strong>ä¸¤ä¸ª token pairsï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è§„åˆ™æ ‡è®°ä¸ºé™é»˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="line"><span class="cl"><span class="c1">// 9. json
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">json</span> <span class="o">=</span> <span class="nx">_</span><span class="p">{</span> <span class="nx">SOI</span> <span class="o">~</span> <span class="p">(</span><span class="kt">object</span> <span class="o">|</span> <span class="nx">array</span><span class="p">)</span> <span class="o">~</span> <span class="nx">EOI</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤æˆ‘ä»¬éœ€è¦ç¼–å†™çš„ pest è§„åˆ™å·²ç»å®Œæˆï¼Œä¸‹é¢å°±æ˜¯æ ¹æ®è§„åˆ™ç”Ÿæˆçš„è§£æç»“æ„æ¥ç”Ÿæˆ ASTã€‚</p>
<h2 id="ast-ç”Ÿæˆå’Œè§£æ">AST ç”Ÿæˆå’Œè§£æ</h2>
<ol>
<li><strong>å®šä¹‰ Pest è§„åˆ™ç»‘å®šçš„ç»“æ„ä½“</strong></li>
</ol>
<p>pest éœ€è¦é€šè¿‡ <strong>grammar</strong> å®æ¥æ ‡è®°åˆ° Rust çš„ç»“æ„ä½“ä¸Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">pest</span>::<span class="n">Parser</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">pest_derive</span>::<span class="n">Parser</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[derive(Parser)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[grammar = </span><span class="s">&#34;pest/json/json.pest&#34;</span><span class="cp">]</span><span class="w"> </span><span class="c1">// æ ¹æ®è‡ªå·±é¡¹ç›®æ–‡ä»¶æ‰€å®š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">JsonParser</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>æ„å»º AST ç”Ÿæˆå‡½æ•°</strong></li>
</ol>
<p>é€šè¿‡ç»‘å®š pest è§„åˆ™çš„ JsonParserï¼Œä½¿ç”¨<code>pest::Parser</code> çš„ parse æ–¹æ³•æ¥<strong>å¾—åˆ°å‰é¢çš„ json è§„åˆ™ç”Ÿæˆçš„ AST ç»“æœ</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">root</span><span class="p">(</span><span class="n">content</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonParser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">Rule</span>::<span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº json ä¸ºé™é»˜è§„åˆ™åªæœ‰<strong>æœ€ç»ˆç”Ÿæˆçš„ token pair å³</strong> <strong><code>Pair&lt;Rule&gt;</code></strong> <strong>ç±»å‹</strong>ï¼Œæ‰€ä»¥åªéœ€è¦<code>next()</code>ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°† AST è§£æå¾—åˆ°æœ€ç»ˆçš„ JsonValueï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥è§£æè¿™ä¸ª<code>Pair&lt;Rule&gt;</code>ã€‚</p>
<ol>
<li><strong>è§£æ AST å‡½æ•°</strong></li>
</ol>
<p>æ–°å¢<code>parse_json_value</code>å‡½æ•°ï¼š</p>
<ul>
<li>ä½¿ç”¨å¾—åˆ°çš„ AST ç»“æœï¼Œæ¥å¯¹ JsonValue ä¸­çš„å„ä¸ªç±»å‹ï¼Œæ ¹æ®å‰é¢ <strong>pest çš„è§„åˆ™è¿›è¡Œè§£æèµ‹å€¼</strong></li>
<li>å…¶ä¸­å¯¹æ•°ç»„å’Œå¯¹è±¡å¤åˆç±»å‹çš„å¤„ç†ï¼Œéœ€è¦é€šè¿‡<strong>é€’å½’å‡½æ•°æ¥æœç´¢åµŒå¥—çš„å€¼</strong></li>
<li>è‹¥åŒ¹é…çš„ Rule ä¸æ˜¯ JsonValue ä¸­çš„ç±»å‹ï¼Œåˆ™ç›´æ¥æŠ¥é”™é€€å‡º</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">parse_json_value</span><span class="p">(</span><span class="n">pair</span>: <span class="nc">Pair</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">JsonValue</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">as_rule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">number</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Number</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">as_str</span><span class="p">().</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="nb">String</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">into_inner</span><span class="p">().</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">as_str</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">boolean</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Boolean</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">as_str</span><span class="p">().</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">null</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Null</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">array</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Array</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">into_inner</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">parse_json_value</span><span class="p">).</span><span class="n">collect</span><span class="p">()),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Rule</span>::<span class="n">object</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">JsonValue</span>::<span class="n">Object</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">pair</span><span class="p">.</span><span class="n">into_inner</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">pair</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">inner_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">into_inner</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inner_rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="w"> </span><span class="c1">// å¾—åˆ° pair è§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">                        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">into_inner</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="w"> </span><span class="c1">// å¾—åˆ° pair è§„åˆ™çš„ç¬¬ä¸€ä¸ª token pair å³ key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">                        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">as_str</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_json_value</span><span class="p">(</span><span class="n">inner_rules</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">unreachable!</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>æœ€ç»ˆé¡¶å±‚å‡½æ•°åŠå‡½æ•°æµ‹è¯•</strong></li>
</ol>
<p>æ ¹æ®ä¸Šä¸€æ­¥çš„è§£æå‡½æ•°ï¼Œæˆ‘ä»¬æ¥<strong>å®Œå–„å‰é¢çš„é¡¶å±‚å‡½æ•°</strong> <strong><code>root</code></strong>ï¼Œå¾—åˆ°æœ€ç»ˆçš„è§£æç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">root</span><span class="p">(</span><span class="n">content</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">JsonValue</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonParser</span>::<span class="n">parse</span><span class="p">(</span><span class="n">Rule</span>::<span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">parse_json_value</span><span class="p">(</span><span class="n">json</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åå¯è¿è¡Œä¸‹é¢æµ‹è¯•å‡½æ•°æ¥éªŒè¯è§£æçš„ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Rust" data-lang="Rust"><span class="line"><span class="cl"><span class="cp">#[cfg(test)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">mod</span> <span class="nn">test</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="n">pest</span>::<span class="n">json</span>::<span class="n">json</span>::<span class="p">{</span><span class="n">JsonValue</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">serialize_json_value</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">test_parse_json_by_pest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;  { </span><span class="se">\&#34;</span><span class="s">a</span><span class="se">\&#34;\t</span><span class="s">: 42,
</span></span></span><span class="line"><span class="cl"><span class="s">  </span><span class="se">\&#34;</span><span class="s">b</span><span class="se">\&#34;</span><span class="s">: [ </span><span class="se">\&#34;</span><span class="s">x</span><span class="se">\&#34;</span><span class="s">, </span><span class="se">\&#34;</span><span class="s">y</span><span class="se">\&#34;</span><span class="s">, 12 ] ,
</span></span></span><span class="line"><span class="cl"><span class="s">  </span><span class="se">\&#34;</span><span class="s">c</span><span class="se">\&#34;</span><span class="s">: { </span><span class="se">\&#34;</span><span class="s">hello</span><span class="se">\&#34;</span><span class="s"> : </span><span class="se">\&#34;</span><span class="s">world</span><span class="se">\&#34;</span><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">  } &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;will try to parse valid JSON data:</span><span class="se">\n\n</span><span class="s">** ********</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s">**********</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// will try to parse valid JSON data:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     **********
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// { &#34;a&#34; : 42,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     &#34;b&#34;: [ &#34;x&#34;, &#34;y&#34;, 12 ] ,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">//     &#34;c&#34;: { &#34;hello&#34; : &#34;world&#34;}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="c1">// **********
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">json_result</span>: <span class="nc">JsonValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;unsuccessful JSON&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;</span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">serialize_json_value</span><span class="p">(</span><span class="o">&amp;</span><span class="n">json_result</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// {&#34;a&#34;:42,&#34;b&#34;:[&#34;x&#34;,&#34;y&#34;,12],&#34;c&#34;:{&#34;hello&#34;:&#34;world&#34;}}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†åŸºäº pest å®ç°çš„ Json è§£æå™¨ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æˆ‘ä»¬é€šè¿‡ä¸Šæ–‡å­¦åˆ°çš„ nom å’Œ pest æ¥å®è·µæ„é€ äº† Json è§£æå™¨ã€‚å…¶ä¸­ nom å’Œ pest éƒ½æ˜¯è¾ƒä¸ºç»å…¸çš„è§£æå™¨åº“ï¼ŒåŸºäºä¸åŒçš„ä¼˜ç§€çš„å®ç°æ€è·¯æ¥å®Œæˆè§£æå™¨ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†è§£æå™¨åº“çš„ç›¸å…³è¯‰æ±‚ã€‚</p>
<p>é€šè¿‡è¿™ä¸¤ç¯‡æ–‡ç« çš„é˜…è¯»ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»èƒ½åŸºæœ¬æŒæ¡ï¼Œé€šè¿‡ Rust è§£æå™¨åº“æ¥å¿«é€Ÿåœ°æ„å»ºè‡ªå·±çš„è‡ªå®šä¹‰è§£æå™¨ï¼Œæ‘†è„±äº†æ‰‹æ’¸è§£æå™¨çš„ç—›ç‚¹ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£åˆ°äº† Parserã€Parser Combinatorã€Json æ ‡å‡†ç­‰ç›¸å…³æ¦‚å¿µã€‚</p>
<p>æœ€åæ„Ÿè°¢å„ä½çš„é˜…è¯»ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°æœ‰æƒ³äº†è§£è§£æå™¨æˆ–ç±»ä¼¼è§£æå™¨éœ€æ±‚çš„åŒå­¦ã€‚</p>
<blockquote>
<p>åç»­ repo é‡Œé¢è¿˜ä¼šå‡†å¤‡æ›´æ–° Redis åè®®çš„è§£æå™¨ï¼Œè€ƒè™‘ç¯‡å¹…å°±ä¸æ”¾åœ¨è¿™é‡Œäº†ã€‚</p>
</blockquote>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<p><a href="https://zhuanlan.zhihu.com/p/146455601" target="_blank" rel="noopener noreffer">https://zhuanlan.zhihu.com/p/146455601</a></p>
<p><a href="https://github.com/rust-bakery/nom?tab=readme-ov-file" target="_blank" rel="noopener noreffer">https://github.com/rust-bakery/nom?tab=readme-ov-file</a></p>
<p><a href="https://www.json.org/json-zh.html" target="_blank" rel="noopener noreffer">https://www.json.org/json-zh.html</a></p>
<p><a href="https://pest.rs/book/examples/json.html" target="_blank" rel="noopener noreffer">https://pest.rs/book/examples/json.html</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2024-01-26</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/rust/4.html/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰" data-via="catwithtudou" data-hashtags="rust,parser"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° WhatsApp" data-sharer="whatsapp" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° ç™¾åº¦" data-sharer="baidu" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Evernote" data-sharer="evernote" data-url="https://zhengyua.cn/posts/rust/4.html/" data-title="ğŸ”¬Build A Parser By Rustï¼ˆä¸‹ï¼‰"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/rust/">rust</a>,&nbsp;<a href="/tags/parser/">parser</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/project/common/0.html/" class="prev" rel="prev" title="åŸºäº Go å®ç°çš„æ¨æ–‡è‡ªåŠ¨åˆ†å‰²è„šæœ¬"><i class="fas fa-angle-left fa-fw"></i>åŸºäº Go å®ç°çš„æ¨æ–‡è‡ªåŠ¨åˆ†å‰²è„šæœ¬</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container">
            <div class="footer-line">
                <span id="run-time"></span>
            </div>
            <span id="busuanzi_container_site_pv">
                æœ¬ç«™è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>æ¬¡
            </span><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/catwithtudou" target="_blank">ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp">æ¸ICPå¤‡19012006å·-1</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸'s blog","id-2":"ä¸€ç›´æ˜¯é˜µé›¨ğŸŒ¦ï¸'s blog"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"},{"display":false,"left":"$","right":"$"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-R5979CFCX0', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-R5979CFCX0" async></script><script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a129553334cecc8d46914f193ead738b";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id: "Ja18LNgLATVSfW2h",ck: "Ja18LNgLATVSfW2h"})</script></body>
</html>
